/*! markdown-it-footnote 3.0.3 https://github.com//markdown-it/markdown-it-footnote @license MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).markdownitFootnote=e()}}((function(){return function e(o,t,n){function r(i,f){if(!t[i]){if(!o[i]){var l="function"==typeof require&&require;if(!f&&l)return l(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var u=t[i]={exports:{}};o[i][0].call(u.exports,(function(e){return r(o[i][1][e]||e)}),u,u.exports,e,o,t,n)}return t[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({1:[function(e,o,t){"use strict";function n(e,o,t,n){var r=Number(e[o].meta.id+1).toString(),s="";return"string"==typeof n.docId&&(s="-"+n.docId+"-"),s+r}function r(e,o){var t=Number(e[o].meta.id+1).toString();return e[o].meta.subId>0&&(t+=":"+e[o].meta.subId),"["+t+"]"}function s(e,o,t,n,r){var s=r.rules.footnote_anchor_name(e,o,t,n,r),i=r.rules.footnote_caption(e,o,t,n,r),f=s;return e[o].meta.subId>0&&(f+=":"+e[o].meta.subId),'<sup class="footnote-ref"><a href="#fn'+s+'" id="fnref'+f+'">'+i+"</a></sup>"}function i(e,o,t){return(t.xhtmlOut?'<hr class="footnotes-sep" />\n':'<hr class="footnotes-sep">\n')+'<section class="footnotes">\n<ol class="footnotes-list">\n'}function f(){return"</ol>\n</section>\n"}function l(e,o,t,n,r){var s=r.rules.footnote_anchor_name(e,o,t,n,r);return e[o].meta.subId>0&&(s+=":"+e[o].meta.subId),'<li id="fn'+s+'" class="footnote-item">'}function a(){return"</li>\n"}function u(e,o,t,n,r){var s=r.rules.footnote_anchor_name(e,o,t,n,r);return e[o].meta.subId>0&&(s+=":"+e[o].meta.subId),' <a href="#fnref'+s+'" class="footnote-backref">↩︎</a>'}o.exports=function(e){var o=e.helpers.parseLinkLabel,t=e.utils.isSpace;e.renderer.rules.footnote_ref=s,e.renderer.rules.footnote_block_open=i,e.renderer.rules.footnote_block_close=f,e.renderer.rules.footnote_open=l,e.renderer.rules.footnote_close=a,e.renderer.rules.footnote_anchor=u,e.renderer.rules.footnote_caption=r,e.renderer.rules.footnote_anchor_name=n,e.block.ruler.before("reference","footnote_def",(function(e,o,n,r){var s,i,f,l,a,u,c,d,p,v,h,m=e.bMarks[o]+e.tShift[o],k=e.eMarks[o];if(m+4>k)return!1;if(91!==e.src.charCodeAt(m))return!1;if(94!==e.src.charCodeAt(m+1))return!1;for(a=m+2;a<k;a++){if(32===e.src.charCodeAt(a))return!1;if(93===e.src.charCodeAt(a))break}if(a===m+2)return!1;if(a+1>=k||58!==e.src.charCodeAt(++a))return!1;if(r)return!0;for(a++,e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.refs||(e.env.footnotes.refs={}),u=e.src.slice(m+2,a-2),e.env.footnotes.refs[":"+u]=-1,(c=new e.Token("footnote_reference_open","",1)).meta={label:u},c.level=e.level++,e.tokens.push(c),s=e.bMarks[o],i=e.tShift[o],f=e.sCount[o],l=e.parentType,h=a,d=p=e.sCount[o]+a-(e.bMarks[o]+e.tShift[o]);a<k&&(v=e.src.charCodeAt(a),t(v));)9===v?p+=4-p%4:p++,a++;return e.tShift[o]=a-h,e.sCount[o]=p-d,e.bMarks[o]=h,e.blkIndent+=4,e.parentType="footnote",e.sCount[o]<e.blkIndent&&(e.sCount[o]+=e.blkIndent),e.md.block.tokenize(e,o,n,!0),e.parentType=l,e.blkIndent-=4,e.tShift[o]=i,e.sCount[o]=f,e.bMarks[o]=s,(c=new e.Token("footnote_reference_close","",-1)).level=--e.level,e.tokens.push(c),!0}),{alt:["paragraph","reference"]}),e.inline.ruler.after("image","footnote_inline",(function(e,t){var n,r,s,i,f=e.posMax,l=e.pos;if(l+2>=f)return!1;if(94!==e.src.charCodeAt(l))return!1;if(91!==e.src.charCodeAt(l+1))return!1;if(n=l+2,(r=o(e,l+1))<0)return!1;if(!t){e.env.footnotes||(e.env.footnotes={}),e.env.footnotes.list||(e.env.footnotes.list=[]),s=e.env.footnotes.list.length,e.md.inline.parse(e.src.slice(n,r),e.md,e.env,i=[]);if(e.tokens[e.tokens.length-1]?.content.includes("<a")){const o=e.push("html_inline","",0);o.content="</a>",o.block=!1}e.push("footnote_ref","",0).meta={id:s},e.env.footnotes.list[s]={content:e.src.slice(n,r),tokens:i}}return e.pos=r+1,e.posMax=f,!0})),e.inline.ruler.after("footnote_inline","footnote_ref",(function(e,o){var t,n,r,s,i=e.posMax,f=e.pos;if(f+3>i)return!1;if(!e.env.footnotes||!e.env.footnotes.refs)return!1;if(91!==e.src.charCodeAt(f))return!1;if(94!==e.src.charCodeAt(f+1))return!1;for(n=f+2;n<i;n++){if(32===e.src.charCodeAt(n))return!1;if(10===e.src.charCodeAt(n))return!1;if(93===e.src.charCodeAt(n))break}return n!==f+2&&(!(n>=i)&&(n++,t=e.src.slice(f+2,n-1),void 0!==e.env.footnotes.refs[":"+t]&&(o||(e.env.footnotes.list||(e.env.footnotes.list=[]),e.env.footnotes.refs[":"+t]<0?(r=e.env.footnotes.list.length,e.env.footnotes.list[r]={label:t,count:0},e.env.footnotes.refs[":"+t]=r):r=e.env.footnotes.refs[":"+t],s=e.env.footnotes.list[r].count,e.env.footnotes.list[r].count++,e.push("footnote_ref","",0).meta={id:r,subId:s,label:t}),e.pos=n,e.posMax=i,!0)))})),e.core.ruler.after("inline","footnote_tail",(function(e){var o,t,n,r,s,i,f,l,a,u,c=!1,d={};if(e.env.footnotes&&(e.tokens=e.tokens.filter((function(e){return"footnote_reference_open"===e.type?(c=!0,a=[],u=e.meta.label,!1):"footnote_reference_close"===e.type?(c=!1,d[":"+u]=a,!1):(c&&a.push(e),!c)})),e.env.footnotes.list)){for(i=e.env.footnotes.list,f=new e.Token("footnote_block_open","",1),e.tokens.push(f),o=0,t=i.length;o<t;o++){for((f=new e.Token("footnote_open","",1)).meta={id:o,label:i[o].label},e.tokens.push(f),i[o].tokens?(l=[],(f=new e.Token("paragraph_open","p",1)).block=!0,l.push(f),(f=new e.Token("inline","",0)).children=i[o].tokens,f.content=i[o].content,l.push(f),(f=new e.Token("paragraph_close","p",-1)).block=!0,l.push(f)):i[o].label&&(l=d[":"+i[o].label]),l&&(e.tokens=e.tokens.concat(l)),s="paragraph_close"===e.tokens[e.tokens.length-1].type?e.tokens.pop():null,r=i[o].count>0?i[o].count:1,n=0;n<r;n++)(f=new e.Token("footnote_anchor","",0)).meta={id:o,subId:n,label:i[o].label},e.tokens.push(f);s&&e.tokens.push(s),f=new e.Token("footnote_close","",-1),e.tokens.push(f)}f=new e.Token("footnote_block_close","",-1),e.tokens.push(f)}}))}},{}]},{},[1])(1)})),define("discourse/plugins/discourse-footnote/initializers/inline-footnotes",["exports","@popperjs/core","discourse/lib/plugin-api","discourse-common/lib/icon-library"],(function(e,o,t,n){"use strict";var r;function s(e){var t,n;null===(t=r)||void 0===t||t.destroy();var s=document.getElementById("footnote-tooltip");if(null==s||s.removeAttribute("data-show"),e.target.classList.contains("expand-footnote")){e.preventDefault(),e.stopPropagation();var i=e.target,f=i.closest(".cooked"),l=i.dataset.footnoteId,a=s.querySelector(".footnote-tooltip-content"),u=f.querySelector("#footnote-".concat(l));a.innerHTML=u.innerHTML;var c=a.querySelector(".footnote-backref");c.parentNode.removeChild(c),s.dataset.show="",null===(n=r)||void 0===n||n.destroy(),r=(0,o.createPopper)(i,s,{modifiers:[{name:"arrow",options:{element:s.querySelector("#arrow")}},{name:"preventOverflow",options:{altAxis:!0,padding:5}},{name:"offset",options:{offset:[0,12]}}]})}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i={name:"inline-footnotes",initialize:function(e){var o,r;e.lookup("site-settings:main").display_footnotes_inline&&(document.documentElement.append((o='\n    <div id="footnote-tooltip" role="tooltip">\n      <div class="footnote-tooltip-content"></div>\n      <div id="arrow" data-popper-arrow></div>\n    </div>\n  ',r=document.createElement("template"),o=o.trim(),r.innerHTML=o,r.content.firstChild)),window.addEventListener("click",s),(0,t.withPluginApi)("0.8.9",(function(e){e.decorateCookedElement((function(e){return function(e){var o=e.querySelectorAll("sup.footnote-ref");o.forEach((function(e){var o=e.querySelector("a");if(o){var t=document.createElement("a");t.classList.add("expand-footnote"),t.innerHTML=(0,n.iconHTML)("ellipsis-h"),t.href="",t.role="button",t.dataset.footnoteId=o.id.replace("footnote-ref-",""),e.after(t)}})),o.length&&e.classList.add("inline-footnotes")}(e)}),{onlyStream:!0,id:"inline-footnotes"})})))},teardown:function(){var e,o;null===(e=r)||void 0===e||e.destroy(),window.removeEventListener("click",s),null===(o=document.getElementById("footnote-tooltip"))||void 0===o||o.remove()}};e.default=i})),define("discourse/plugins/discourse-footnote/lib/discourse-markdown/footnotes",["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.setup=function(e){e.registerOptions((function(e,o){e.features.footnotes=!!o.enable_markdown_footnotes})),e.allowList(["ol.footnotes-list","hr.footnotes-sep","li.footnote-item","a.footnote-backref","sup.footnote-ref"]),e.allowList({custom:function(e,o,t){if(("a"===e||"li"===e)&&"id"===o)return!!t.match(/^fn(ref)?\d+$/)}}),e.registerPlugin(window.markdownitFootnote)}}));
//# sourceMappingURL=https://dub2.discourse-cdn.com/arduino/assets/plugins/discourse-footnote-9b63d2c7e0607e2d27114241862d87eaaad8f39cf68679c6e12aa1ed65a9b0af.js.map